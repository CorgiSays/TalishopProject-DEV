<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Van Tech Talishop</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>

<script>
    var disablePC = false;
    function isPhone() {
        return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    }

    if (!isPhone() && disablePC) {
        window.location.href = "pageunavailable.html";
    }
</script>

<div class="header-bar"></div>
<header>
    <button id="toggleButton" onclick="toggleSidebar()">
        <img alt="sidebaropen" height="55" width="55" src="images\sidebaropen.png">
    </button>
    <div class="logo-text">
        <div class="logo-text"><img class="topbartext" width=70% src="images\talishop.logo.png" width="50%"></div>
    </div>
    <img class="header-logo" id="toggleIcon" src="images\bearlogo.jpg">
</header>

<div class="gray-line"></div>

<div class="sidebar" id="sidebar">
    <div class="largeText">
        <a href="index.html">Home</a>
        <a href="catalogue.html">Catalogue</a>
        <a href="about.html">About Us</a>
        <div class="sidebarBreak">
            <div class="gray-line"></div>
        </div>
    </div>
    <div class="sideBarFollowHeaderText">FOLLOW US</div>
    <div class="sidebarFollow">
        <img src="https://s3-alpha-sig.figma.com/img/cded/6cb8/66c62828bc59be1d17a3525e693ddcb4?Expires=1714953600&Key-Pair-Id=APKAQ4GOSFWCVNEHN3O4&Signature=k3sqEWDkC8S3KkfbEcEfh~ppHv0vvEjQC0ivp-M8XRGtZIZHcvFqnO9XANpQ6X6W3OXIHIEatQDaL8BNMN3GLhGWfU86dR7XzSvKMGyVTRB5~e8~-eOYb1cgqU1tq27WYlT33PGOe7zirYxkv1BH6Gi-COF97QiX7DIX6anC4fMHVodpeJGZoW0o8Ph~iw9656RVThNO-7jm56shu8GJEf7DLiJ0gjmqifDs79iQBf6aFAdvgL-vrCvMNoG8MmI-~ETZpT2lpWq0SuvSGFL32PJzySXvegisbFQqhQV5iPH5aE2t6BvM3y4KW9n-Tnct9to2AZ2lJwkScvO0c0NM-A__" height="50px"><a href="https://www.instagram.com/vt.talishop?igsh=czIzMmM3czljbzdp&utm_source=qr">vt.talishop</a>
    </div>
</div>

<div class="controls-section">
    <div class="category-dropdown">
        <select id="categoryDropdown" onchange="filterProductsDropdown()">
            <option value="All">All</option>
            <option value="Chips">Chips</option>
            <option value="Cookies">Cookies</option>
            <option value="Bars">Bars</option>
            <option value="Other">Other</option>
            <option value="Drinks">Drinks</option>
            <option value="Frozen">Frozen</option>
            <option value="Supplies">Supplies</option>
        </select>
    </div>
    <button id="toggleControlsButton" onclick="toggleControls()"><b>Filter and Sort</b></button>
</div>

<div id="controlsContainer" class="controls-container">
    <div class="search-bar">
        <input type="text" id="searchInput" placeholder="Search products..." oninput="searchProducts()">
    </div>

    <label><input type="checkbox" id="peanutFreeCheckbox" onclick="applyFilters()">Peanut Free |</label>
    <label><input type="checkbox" id="almondFreeCheckbox" onclick="applyFilters()">Almond Free |</label>
    <label for="sortDropdown">Sort By:</label>
    <select id="sortDropdown" onchange="sortCatalogue()">
        <option value="default">Default</option>
        <option value="price">Price</option>
        <option value="alphabetical">Alphabetical</option>
    </select>
</div>

<div class="category-divider"></div>


<div class="catalogue-container"></div>

<div class="product-details-container">
    <button onclick="hideProductDetails()">Back</button>
    <h2>Product Details</h2>
    <img id="productImage" alt="Product Image">
    <p id="productName"></p>
    <p id="productDescription"></p>
    <p id="productPrice"></p>
</div>

<footer>
    <div class="footer-info">
        <div class="social-media-buttons">
            <a href="#"><img src="https://s3-alpha-sig.figma.com/img/b987/11fe/3d1a36b2533503157dfc4dc49cfff9a7?Expires=1714953600&Key-Pair-Id=APKAQ4GOSFWCVNEHN3O4&Signature=Ye6AJAtl2GyWt7Pax0wVjEIYa4E-xyzet6lVLG~QPndFlfwytFsfXNjRYN0GXPLXfubFVifvo-t05z2vqJcfsfNARIFm74hENccN0KDa5dmmFNIm~EaFWwBPoKVk6SoJdfjHvUMUJWY2rTrlz9Tzzm5TDQJCv43foNM9HTnTVC~50qixS7Ug-769Mt3nrX7bLGBiipmiqZRWKo0HQKY~V-hw75p1G2vKoxND1aa8n82nOYxgTyvEXT65GYneNQg~eDoYfJoRfRw7u6rKrogi~mqYZe1P5nlfuT1LoGUA~0dBhkDKJG3W34aI5r-dw4PKebe1st8DthdfGHpY60UO0w__" alt="Email" height="30px"></a>
            <a href="https://www.instagram.com/vt.talishop?igsh=czIzMmM3czljbzdp&utm_source=qr"><img src="https://s3-alpha-sig.figma.com/img/cded/6cb8/66c62828bc59be1d17a3525e693ddcb4?Expires=1714953600&Key-Pair-Id=APKAQ4GOSFWCVNEHN3O4&Signature=k3sqEWDkC8S3KkfbEcEfh~ppHv0vvEjQC0ivp-M8XRGtZIZHcvFqnO9XANpQ6X6W3OXIHIEatQDaL8BNMN3GLhGWfU86dR7XzSvKMGyVTRB5~e8~-eOYb1cgqU1tq27WYlT33PGOe7zirYxkv1BH6Gi-COF97QiX7DIX6anC4fMHVodpeJGZoW0o8Ph~iw9656RVThNO-7jm56shu8GJEf7DLiJ0gjmqifDs79iQBf6aFAdvgL-vrCvMNoG8MmI-~ETZpT2lpWq0SuvSGFL32PJzySXvegisbFQqhQV5iPH5aE2t6BvM3y4KW9n-Tnct9to2AZ2lJwkScvO0c0NM-A__" alt="Instagram" height="30px"></a>
            <a href="#"><img src="https://s3-alpha-sig.figma.com/img/8182/38b7/3fe8c56ecbeb1ac7d18fe93cdbefbd09?Expires=1714953600&Key-Pair-Id=APKAQ4GOSFWCVNEHN3O4&Signature=kIiQMTZzbz95J1lReDqS-4LBxGkz43ReIOJ0glg3qjwN0PJIAzDInoVWF7kU2UGB5mnBjEYfK19Nlbq0alIM5WdR-xkr0aQ-Fwh0b6JmRU4OdHDvH2UnOPm5hNrQ38Zj7JITsJc3aYNgm1kQbgkrPoGeZPlGRT6p10YhKtdP5Z-Pui8fXC9QpyBtcZNzwzLn~qLFTEfnskmcDBemx0CdYkLQhE4BqhFXkamZHhTHTrCKiDDjp~WxBXWymYyGd-WUomMF6OAPpfvVEbLLdMNT5u4mnU-ocunP5UgU1xOe9YjKJ7y78tAWGlz7RdjpmA6bBmT~LDvhMrNIbWo4ia9AYQ__" alt="Facebook" height="30px"></a>
        </div>
    </div>
</footer>

<script src="products.js"></script>
<script>
    window.onload = function() {
        var toggleIcon = document.getElementById("toggleIcon");
        var sidebar = document.getElementById("sidebar");

        toggleIcon.addEventListener("click", function() {
            if (sidebar.style.left === "0px" || sidebar.style.left === "") {
                sidebar.style.left = "-100%";
                toggleIcon.src = "https://s3-alpha-sig.figma.com/img/1e02/5487/7c1563c850db396e16220d14e55e3241?Expires=1713744000&Key-Pair-Id=APKAQ4GOSFWCVNEHN3O4&Signature=W-ygkk-v5EQsZSmShthAxNJN7TbjXCirHkVBggq6NY4xRERgChdoWQTSimFTtGd5tmUoJVXSAJYoPdJA-p80zmnyYIMdl6YUpNyoKvCygAsaY~YGGTfu5F4Ed2KUkFcm0JHKnrdSlesNG8RoaWvi~hNKPcyx6dIweHzLxyBSzVwbHrx5bAryGybWSBoNYr7bseOhbZKm1NzCV8MZrpNKMigtSZrhqy-ye6rNCcUnkjcJ7vj0n3S0NREBuOIFyPnCMynaL-e0ru45h6lOQD-8kjQ-5-gNrR0F4TrZLpD2gH1WSvxPt79K235RoXpnB~75YZctVF5CrqT71V8hyH9IaQ__";
            }
        });
    }

    function toggleSidebar() {
        var sidebar = document.getElementById("sidebar");
        var body = document.body;
        if (sidebar.style.left === "0px" || sidebar.style.left === "") {
            sidebar.style.left = "-100%";
            body.classList.remove("sidebar-open");
        } else {
            sidebar.style.left = "0";
            body.classList.add("sidebar-open");
        }
        var toggleIcon = document.getElementById("toggleIcon");
        toggleIcon.src = (sidebar.style.left === "0px" || sidebar.style.left === "") ? "images/closebutton.png" : "images/bearlogo.jpg";
    }

    const catalogueProducts = products;

    function renderCatalogue(products) {
        var catalogueContainer = document.querySelector(".catalogue-container");
        catalogueContainer.innerHTML = '';

        var currentCategory = null;

        products.forEach(function(product, index) {
            if (currentCategory !== product[0]) {
                var categoryTitle = document.createElement("h2");
                categoryTitle.textContent = product[0];
                catalogueContainer.appendChild(categoryTitle);

                currentCategory = product[0];
            }

            var productElement = document.createElement("div");
            productElement.className = "product";

            if (product[1] !== " " && product[1] !== "") {
                var productImage = document.createElement("img");
                productImage.src = product[1];
                productImage.alt = product[2];
            } else {
                var productImage = document.createElement("img");
                productImage.src = "https://static-00.iconduck.com/assets.00/no-image-icon-512x512-lfoanl0w.png";
                productImage.alt = "No image available.";
            }

            var productName = document.createElement("p");
            productName.innerHTML = "<b>" + product[2] + "</b><br>" + product[3] + "<br>$" + product[4];

            var productWarnings = document.createElement("div");
            productWarnings.className = "warnings";

            if (product[5] === "1") {
                var warningText = document.createElement("img");
                warningText.src = 'https://www.svgrepo.com/show/56033/peanuts.svg';
                warningText.style.height = '20px';
                warningText.style.width = warningText.style.height;
                productWarnings.appendChild(warningText);
            }

            if (product[6] === "1") {
                var warningText = document.createElement("img");
                warningText.src = 'https://us.123rf.com/450wm/deepfuze/deepfuze1807/deepfuze180700674/114799291-shelled-almond-isolated-on-a-white-background.jpg?ver=6';
                warningText.style.height = '20px';
                warningText.style.width = warningText.style.height;
                productWarnings.appendChild(warningText);
            }

            productElement.appendChild(productImage);
            productElement.appendChild(productName);
            productElement.appendChild(productWarnings);

            catalogueContainer.appendChild(productElement);

            productElement.addEventListener("click", function () {
                showProductDetails(product);
            });

            if (index < products.length - 1 && products[index + 1][0] !== currentCategory) {
                var categoryDivider = document.createElement("div");
                categoryDivider.className = "category-divider";
                catalogueContainer.appendChild(categoryDivider);
            }
        });
    }

    function filterProducts(category) {
        if (category === 'All') {
            renderCatalogue(catalogueProducts);
        } else {
            var filteredProducts = catalogueProducts.filter(function (product) {
                return product[0] === category;
            });
            renderCatalogue(filteredProducts);
        }
    }

    function filterProductsDropdown() {
        var categoryDropdown = document.getElementById("categoryDropdown");
        var selectedCategory = categoryDropdown.value;

        if (selectedCategory === 'All') {
            renderCatalogue(catalogueProducts);
        } else {
            var filteredProducts = catalogueProducts.filter(function (product) {
                return product[0] === selectedCategory;
            });
            sortCatalogue()
            renderCatalogue(filteredProducts);
        }
    }

    function showProductDetails(product) {
        document.getElementById("productName").innerHTML = "<b>Product:</b> " + product[2];
        document.getElementById("productDescription").innerHTML = "<b>Description:</b> " + product[7];
        document.getElementById("productPrice").innerHTML = "<b>Price:</b> $" + product[4];

        var productImage = document.getElementById("productImage");
        productImage.src = product[1];
        productImage.alt = product[2];

        document.querySelector(".product-details-container").style.right = "0";
    }

    function hideProductDetails() {
        document.querySelector(".product-details-container").style.right = "-100%";
    }

    function searchProducts() {
        var searchInput = document.getElementById("searchInput").value.toLowerCase();
        var filteredProducts = catalogueProducts.filter(function (product) {
            return product[2].toLowerCase().includes(searchInput) || product[3].toLowerCase().includes(searchInput);
        });
        renderCatalogue(filteredProducts);
    }

    function applyFilters() {
        var peanutFreeChecked = document.getElementById("peanutFreeCheckbox").checked;
        var almondFreeChecked = document.getElementById("almondFreeCheckbox").checked;

        var filteredProducts = catalogueProducts.filter(function (product) {
            var passesFilter = true;
            if (peanutFreeChecked && product[5] === "1") {
                passesFilter = false;
            }
            if (almondFreeChecked && product[6] === "1") {
                passesFilter = false;
            }
            return passesFilter;
        });

        renderCatalogue(filteredProducts);
    }

    const defaultOrder = catalogueProducts.slice();

    function sortCatalogue() {
        var sortOption = document.getElementById("sortDropdown").value;

        if (sortOption === "default") {
            renderCatalogue(defaultOrder);
        } else if (sortOption === "price") {
            catalogueProducts.sort(function(a, b) {
                return parseFloat(a[4]) - parseFloat(b[4]);
            });
            renderCatalogue(catalogueProducts);
        } else if (sortOption === "alphabetical") {
            catalogueProducts.sort(function(a, b) {
                return a[2].localeCompare(b[2]);
            });
            renderCatalogue(catalogueProducts);
        }
    }

    function toggleControls() {
        var controlsContainer = document.getElementById('controlsContainer');
        if (controlsContainer.style.display === 'none') {
            controlsContainer.style.display = 'block';
        } else {
            controlsContainer.style.display = 'none';
        }
    }


    renderCatalogue(catalogueProducts);
</script>
</body>
</html>